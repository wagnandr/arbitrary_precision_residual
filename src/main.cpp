#include "highprecision_csr.hpp"

int main(void)
{
  test();

  set_precision(128);

  const std::vector<double> data = {1.0, 130321.0, -521284.0, 651605.0, -261003.0, 130321.0, -521284.0, 781926.0, -521284.0, 130321.0, 130321.0, -521284.0, 781926.0, -521284.0, 130321.0, 130321.0, -521284.0, 781926.0, -521284.0, 130321.0, 130321.0, -521284.0, 781926.0, -521284.0, 130321.0, 130321.0, -521284.0, 781926.0, -521284.0, 130321.0, 130321.0, -521284.0, 781926.0, -521284.0, 130321.0, 130321.0, -521284.0, 781926.0, -521284.0, 130321.0, 130321.0, -521284.0, 781926.0, -521284.0, 130321.0, 130321.0, -521284.0, 781926.0, -521284.0, 130321.0, 130321.0, -521284.0, 781926.0, -521284.0, 130321.0, 130321.0, -521284.0, 781926.0, -521284.0, 130321.0, 130321.0, -521284.0, 781926.0, -521284.0, 130321.0, 130321.0, -521284.0, 781926.0, -521284.0, 130321.0, 130321.0, -521284.0, 781926.0, -521284.0, 130321.0, 130321.0, -521284.0, 781926.0, -521284.0, 130321.0, 130321.0, -521284.0, 781926.0, -521284.0, 130321.0, -261003.0, 651605.0, -521284.0, 130321.0, 1.0};
  const std::vector<int> indices = {0, 3, 2, 1, 0, 4, 3, 2, 1, 0, 5, 4, 3, 2, 1, 6, 5, 4, 3, 2, 7, 6, 5, 4, 3, 8, 7, 6, 5, 4, 9, 8, 7, 6, 5, 10, 9, 8, 7, 6, 11, 10, 9, 8, 7, 12, 11, 10, 9, 8, 13, 12, 11, 10, 9, 14, 13, 12, 11, 10, 15, 14, 13, 12, 11, 16, 15, 14, 13, 12, 17, 16, 15, 14, 13, 18, 17, 16, 15, 14, 19, 18, 17, 16, 15, 19, 18, 17, 16, 19};
  const std::vector<int> indptr = {0, 1, 5, 10, 15, 20, 25, 30, 35, 40, 45, 50, 55, 60, 65, 70, 75, 80, 85, 89, 90};
  const size_t rows = 20;
  const size_t cols = 20;

  const std::vector<std::string> vec = { "0.0", "0.053401536691552489224", "0.10534641866957603217", "0.15441772496391131386", "0.19927691825819729695", "0.23870035669855518651", "0.27161267165356599647", "0.29711610096725885601", "0.3145149775704346187", "0.32333470546484491145", "0.32333470546484491784", "0.31451497757043463769", "0.29711610096725888709", "0.27161267165356603878", "0.23870035669855523891", "0.199276918258197358", "0.1544177249639113819", "0.10534641866957610534", "0.053401536691552565536", "7.736798594658482297e-17" };

  auto matrix = create_csr_matrix(data, indices, indptr, rows, cols);
  auto vector = create_vector(vec);

  auto result = matrix * vector;

  mpfr::mpreal expected = "31.352520052418097";

  std::cout << "difference " << (result[10] - expected) << std::endl;

  return 0;
}
